---
export const prerender = false;

import Layout from '../components/Layout.astro';
import EventHeroCarousel from '../components/EventHeroCarousel.astro';
import AnnouncementMarquee from '../components/AnnouncementMarquee.astro';
import { db } from '../lib/supabase';
import type { Database } from '../types/database';

// Fetch all approved events
const { data: allEvents, error: allEventsError } = await db.events.getAll();

if (allEventsError) {
  console.error('Error fetching events:', allEventsError);
}

// Fetch featured events
const { data: featuredEvents, error: featuredEventsError } = await db.events.getFeatured();

if (featuredEventsError) {
  console.error('Error fetching featured events:', featuredEventsError);
}

const events = allEvents || [];
const featured = featuredEvents || [];

console.log('Database Results:', {
  allEventsResult: { data: allEvents, error: allEventsError },
  featuredEventsResult: { data: featuredEvents, error: featuredEventsError },
  upcomingEventsCount: events.length,
  featuredEventsCount: featured.length
});

console.log('Final allEvents:', events.map(e => ({
  id: e.id,
  title: e.title,
  primary_tag: e.primary_tag,
  secondary_tag: e.secondary_tag
})));
---

<Layout title="Der Town Community Events">
  <main class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
    <!-- Announcement Marquee -->
    <AnnouncementMarquee />
    
    <!-- Hero Section -->
    <section class="relative py-12 px-4 sm:px-6 lg:px-8">
      <div class="max-w-7xl mx-auto">
        <div class="flex flex-col lg:flex-row items-center gap-12">
          <!-- Hero Text -->
          <div class="flex-1 text-center lg:text-left mb-12 lg:mb-0">
            <h1 class="text-4xl md:text-6xl font-bold text-gray-900 mb-6">
              Welcome to <span class="text-indigo-600">Der Town</span>
            </h1>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto lg:mx-0">
              Discover amazing community events, activities, and gatherings happening in our vibrant town.
            </p>
          </div>
          <!-- Carousel -->
          <div class="w-full max-w-3xl mx-auto">
            <EventHeroCarousel events={events} />
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>
